{
    "info": {
        "_postman_id": "wallet-api-collection-2026",
        "name": "Wallet API - Event Sourcing",
        "description": "API de Wallet com Event Sourcing, DDD e Clean Architecture.\n\n**Fluxo típico:**\n1. Register (cria user + wallet)\n2. Login (obtém token)\n3. Deposit (adiciona saldo)\n4. Transfer (por email do destinatário)\n5. Withdraw (saca saldo)",
        "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
    },
    "variable": [
        {
            "key": "base_url",
            "value": "http://localhost:8080",
            "type": "string"
        },
        {
            "key": "token",
            "value": "",
            "type": "string"
        },
        {
            "key": "user_id",
            "value": "",
            "type": "string"
        },
        {
            "key": "wallet_id",
            "value": "",
            "type": "string"
        },
        {
            "key": "user_email",
            "value": "",
            "type": "string"
        }
    ],
    "item": [
        {
            "name": "Auth",
            "item": [
                {
                    "name": "Register User",
                    "event": [
                        {
                            "listen": "prerequest",
                            "script": {
                                "exec": [
                                    "const email = 'user' + Date.now() + '@test.com';",
                                    "pm.collectionVariables.set('user_email', email);"
                                ],
                                "type": "text/javascript"
                            }
                        },
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "var jsonData = pm.response.json();",
                                    "if (jsonData.token) {",
                                    "    pm.collectionVariables.set('token', jsonData.token);",
                                    "}",
                                    "if (jsonData.user && jsonData.user.id) {",
                                    "    pm.collectionVariables.set('user_id', jsonData.user.id);",
                                    "}",
                                    "if (jsonData.wallet_id) {",
                                    "    pm.collectionVariables.set('wallet_id', jsonData.wallet_id);",
                                    "}",
                                    "",
                                    "pm.test('Status code is 201', function () {",
                                    "    pm.response.to.have.status(201);",
                                    "});",
                                    "",
                                    "pm.test('Response has token', function () {",
                                    "    pm.expect(jsonData).to.have.property('token');",
                                    "});",
                                    "",
                                    "pm.test('Response has wallet_id', function () {",
                                    "    pm.expect(jsonData).to.have.property('wallet_id');",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"name\": \"Test User\",\n    \"email\": \"{{user_email}}\",\n    \"password\": \"senha123456\",\n    \"password_confirmation\": \"senha123456\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/auth/register",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "auth",
                                "register"
                            ]
                        }
                    }
                },
                {
                    "name": "Login",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "var jsonData = pm.response.json();",
                                    "if (jsonData.token) {",
                                    "    pm.collectionVariables.set('token', jsonData.token);",
                                    "}",
                                    "if (jsonData.wallet_id) {",
                                    "    pm.collectionVariables.set('wallet_id', jsonData.wallet_id);",
                                    "}",
                                    "",
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Response has token', function () {",
                                    "    pm.expect(jsonData).to.have.property('token');",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"email\": \"{{user_email}}\",\n    \"password\": \"senha123456\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/auth/login",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "auth",
                                "login"
                            ]
                        }
                    }
                },
                {
                    "name": "Get User Info",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Response has user data', function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.have.property('data');",
                                    "    pm.expect(jsonData.data).to.have.property('id');",
                                    "    pm.expect(jsonData.data).to.have.property('wallet_id');",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "GET",
                        "header": [
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/api/user",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "user"
                            ]
                        }
                    }
                },
                {
                    "name": "Logout",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "POST",
                        "header": [
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/api/auth/logout",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "auth",
                                "logout"
                            ]
                        }
                    }
                }
            ]
        },
        {
            "name": "Wallet",
            "item": [
                {
                    "name": "Get Wallet",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Response has balance', function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.data).to.have.property('balance');",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "GET",
                        "header": [
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/api/wallet",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "wallet"
                            ]
                        }
                    }
                },
                {
                    "name": "Get Balance",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Response has balance_cents and balance', function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.have.property('balance');",
                                    "    pm.expect(jsonData).to.have.property('currency');",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "GET",
                        "header": [
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/api/wallet/balance",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "wallet",
                                "balance"
                            ]
                        }
                    }
                },
                {
                    "name": "Get Transactions",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Response is array with amount_cents', function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.be.an('array');",
                                    "    if (jsonData.length > 0) {",
                                    "        pm.expect(jsonData[0]).to.have.property('amount_cents');",
                                    "        pm.expect(jsonData[0]).to.have.property('type');",
                                    "    }",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "GET",
                        "header": [
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/api/wallet/transactions",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "wallet",
                                "transactions"
                            ]
                        }
                    }
                },
                {
                    "name": "Deposit",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Response has balance_cents and balance', function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.wallet).to.have.property('balance_cents');",
                                    "    pm.expect(jsonData.wallet).to.have.property('balance');",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Accept",
                                "value": "application/json"
                            },
                            {
                                "key": "Idempotency-Key",
                                "value": "{{$guid}}",
                                "description": "Auto-generated UUID for each request"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"amount\": \"100.00\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/wallet/deposit",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "wallet",
                                "deposit"
                            ]
                        }
                    }
                },
                {
                    "name": "Withdraw",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Response has balance_cents and balance', function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.wallet).to.have.property('balance_cents');",
                                    "    pm.expect(jsonData.wallet).to.have.property('balance');",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Accept",
                                "value": "application/json"
                            },
                            {
                                "key": "Idempotency-Key",
                                "value": "{{$guid}}",
                                "description": "Auto-generated UUID for each request"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"amount\": \"25.00\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/wallet/withdraw",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "wallet",
                                "withdraw"
                            ]
                        }
                    }
                }
            ]
        },
        {
            "name": "Transfer",
            "description": "Para testar transfer:\n1. Crie outro usuário primeiro (ou use um email existente)\n2. Use o email desse usuário como recipient_email",
            "item": [
                {
                    "name": "Transfer Money (by Email)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Response has sender and recipient with cents', function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.have.property('sender');",
                                    "    pm.expect(jsonData.sender).to.have.property('balance_cents');",
                                    "    pm.expect(jsonData).to.have.property('recipient');",
                                    "    pm.expect(jsonData.recipient).to.have.property('balance_cents');",
                                    "    pm.expect(jsonData).to.have.property('amount_cents');",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Accept",
                                "value": "application/json"
                            },
                            {
                                "key": "Idempotency-Key",
                                "value": "{{$guid}}",
                                "description": "Auto-generated UUID for each request"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"recipient_email\": \"recipient@test.com\",\n    \"amount\": \"50.00\",\n    \"metadata\": {\n        \"description\": \"Payment for services\"\n    }\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/transfers",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "transfers"
                            ]
                        }
                    }
                }
            ]
        },
        {
            "name": "Error Cases",
            "item": [
                {
                    "name": "Login - Invalid Credentials (401)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Status code is 401', function () {",
                                    "    pm.response.to.have.status(401);",
                                    "});",
                                    "",
                                    "pm.test('Response has error', function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.have.property('error');",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"email\": \"wrong@test.com\",\n    \"password\": \"wrongpassword\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/auth/login",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "auth",
                                "login"
                            ]
                        }
                    }
                },
                {
                    "name": "Transfer - Recipient Not Found (404)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Status code is 404', function () {",
                                    "    pm.response.to.have.status(404);",
                                    "});",
                                    "",
                                    "pm.test('Response has error', function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.have.property('error');",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Accept",
                                "value": "application/json"
                            },
                            {
                                "key": "Idempotency-Key",
                                "value": "{{$guid}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"recipient_email\": \"nonexistent@test.com\",\n    \"amount\": \"50.00\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/transfers",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "transfers"
                            ]
                        }
                    }
                },
                {
                    "name": "Withdraw - Insufficient Balance (422)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Status code is 422', function () {",
                                    "    pm.response.to.have.status(422);",
                                    "});",
                                    "",
                                    "pm.test('Response has error', function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.have.property('error');",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Accept",
                                "value": "application/json"
                            },
                            {
                                "key": "Idempotency-Key",
                                "value": "{{$guid}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"amount\": \"999999.00\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/wallet/withdraw",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "wallet",
                                "withdraw"
                            ]
                        }
                    }
                },
                {
                    "name": "Protected Route - Unauthenticated (401)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Status code is 401', function () {",
                                    "    pm.response.to.have.status(401);",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/api/wallet/balance",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "wallet",
                                "balance"
                            ]
                        }
                    }
                }
            ]
        }
    ]
}